// ==UserScript==
// @name         Stripe Form Helper
// @namespace    http://tampermonkey.net/
// @version      1.1
// @description  Hi·ªÉn th·ªã form h·ªó tr·ª£ tr√™n stripe.com
// @author       You
// @match        https://*.stripe.com/*
// @grant        GM_addStyle
// @license MIT
// @copyright 2025, vietquang99 (https://openuserjs.org/users/vietquang99)
/* jshint esversion: 6 */
// ==/UserScript==

(function () {
    'use strict';

    // Danh s√°ch t√™n ng·∫´u nhi√™n
    var firstNames = ['John', 'Jane', 'Michael', 'Emily', 'David', 'Sarah', 'James', 'Emma', 'Robert', 'Olivia', 'William', 'Sophia', 'Daniel', 'Isabella', 'Matthew', 'Mia', 'Andrew', 'Charlotte', 'Joseph', 'Amelia'];
    var lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin'];

    // Danh s√°ch t·ª´ ng·∫´u nhi√™n cho ƒë·ªãa ch·ªâ
    var randomWords = ['Oak', 'Pine', 'Maple', 'Cedar', 'Elm', 'Birch', 'Willow', 'Ash', 'Cherry', 'Walnut', 'Spring', 'River', 'Lake', 'Hill', 'Valley', 'Forest', 'Meadow', 'Brook', 'Stone', 'Park', 'Green', 'Blue', 'Red', 'White', 'Black', 'North', 'South', 'East', 'West', 'Central'];

    // H√†m l·∫•y random item t·ª´ array
    function getRandomItem(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }

    // H√†m simulate input event (ƒë·ªÉ trigger React/Vue state update)
    function setInputValue(element, value) {
        // Ki·ªÉm tra lo·∫°i element ƒë·ªÉ s·ª≠ d·ª•ng ƒë√∫ng prototype
        var prototype;
        if (element.tagName === 'SELECT') {
            prototype = window.HTMLSelectElement.prototype;
        } else if (element.tagName === 'TEXTAREA') {
            prototype = window.HTMLTextAreaElement.prototype;
        } else {
            prototype = window.HTMLInputElement.prototype;
        }
        
        var nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value');
        if (nativeValueSetter && nativeValueSetter.set) {
            nativeValueSetter.set.call(element, value);
        } else {
            element.value = value;
        }
        
        element.dispatchEvent(new Event('input', {
            bubbles: true
        }));
        element.dispatchEvent(new Event('change', {
            bubbles: true
        }));
    }

    // H√†m t·∫°o random s·ªë
    function getRandomNumbers(length) {
        var result = '';
        for (var i = 0; i < length; i++) {
            result += Math.floor(Math.random() * 10);
        }
        return result;
    }

    // H√†m t·∫°o random s·ªë b·∫Øt ƒë·∫ßu t·ª´ 0 ho·∫∑c 1
    function getRandomPostalCode() {
        var firstDigit = Math.random() < 0.5 ? '0' : '1';
        return firstDigit + getRandomNumbers(5);
    }

    // H√†m t·∫°o random address line (1-3 s·ªë + 2 t·ª´)
    function generateRandomAddressLine() {
        var numCount = Math.floor(Math.random() * 3) + 1; // 1-3 s·ªë
        var numbers = '';
        for (var i = 0; i < numCount; i++) {
            numbers += Math.floor(Math.random() * 10);
        }
        var word1 = getRandomItem(randomWords);
        var word2 = getRandomItem(randomWords);
        return numbers + ' ' + word1 + ' ' + word2;
    }

    // H√†m t·∫°o random 2 t·ª´
    function generateRandomTwoWords() {
        var word1 = getRandomItem(randomWords);
        var word2 = getRandomItem(randomWords);
        return word1 + ' ' + word2;
    }

    // H√†m ch·ªçn random option trong SELECT element
    function selectRandomOption(selectElement) {
        var options = selectElement.options;
        if (options.length <= 1) return false; // Kh√¥ng c√≥ option ho·∫∑c ch·ªâ c√≥ placeholder
        
        // B·ªè qua option ƒë·∫ßu ti√™n n·∫øu n√≥ l√† placeholder (value r·ªóng ho·∫∑c disabled)
        var startIndex = 0;
        if (options[0].value === '' || options[0].disabled) {
            startIndex = 1;
        }
        
        if (startIndex >= options.length) return false;
        
        // Ch·ªçn random t·ª´ startIndex ƒë·∫øn cu·ªëi
        var randomIndex = startIndex + Math.floor(Math.random() * (options.length - startIndex));
        selectElement.selectedIndex = randomIndex;
        
        // Dispatch events
        selectElement.dispatchEvent(new Event('change', { bubbles: true }));
        selectElement.dispatchEvent(new Event('input', { bubbles: true }));
        
        return true;
    }

    // H√†m hi·ªÉn th·ªã th√¥ng b√°o tr√™n UI
    function showMessage(message, type, duration) {
        type = type || 'info';
        duration = duration || 3000;

        var messageEl = document.getElementById('wh-message');
        if (!messageEl) return;

        // X√≥a c√°c class type c≈©
        messageEl.className = 'wh-message';
        messageEl.classList.add(type);
        messageEl.textContent = message;
        messageEl.classList.remove('wh-hidden');
        messageEl.classList.add('wh-visible');

        // T·ª± ƒë·ªông ·∫©n sau duration ms
        if (duration > 0) {
            setTimeout(function () {
                messageEl.classList.remove('wh-visible');
                messageEl.classList.add('wh-hidden');
            }, duration);
        }
    }

    // T·∫°o container cho form
    var formContainer = document.createElement('div');
    formContainer.id = 'stripe-helper-form';
    formContainer.innerHTML =
        '<div id="wh-form-wrapper">' +
        '<div id="wh-header">' +
        '<span>üí≥ Stripe Helper</span>' +
        '<button id="wh-toggle-btn">‚àí</button>' +
        '</div>' +
        '<div id="wh-content">' +
        '<div id="wh-message" class="wh-message wh-hidden"></div>' +
        '<div class="wh-buttons">' +
        '<button id="wh-fill-human" class="wh-btn wh-btn-primary">Fill Human Info</button>' +
        '</div>' +
        '</div>' +
        '</div>';

    // CSS styles - s·ª≠ d·ª•ng GM_addStyle ƒë·ªÉ bypass CSP
    var cssText =
        '#stripe-helper-form {' +
        'position: fixed;' +
        'bottom: 10px;' +
        'right: 10px;' +
        'z-index: 999999;' +
        'font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;' +
        '}' +
        '#wh-form-wrapper {' +
        'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);' +
        'border-radius: 12px;' +
        'box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);' +
        'overflow: hidden;' +
        'min-width: 280px;' +
        'max-width: 320px;' +
        '}' +
        '@media (max-width: 480px) {' +
        '#wh-form-wrapper {' +
        'min-width: 200px;' +
        'max-width: 220px;' +
        '}' +
        '#wh-header {' +
        'padding: 8px 10px;' +
        'font-size: 12px;' +
        '}' +
        '#wh-content {' +
        'padding: 10px;' +
        '}' +
        '.wh-btn {' +
        'padding: 6px 10px;' +
        'font-size: 11px;' +
        '}' +
        '.wh-message {' +
        'padding: 6px 8px;' +
        'font-size: 10px;' +
        '}' +
        '}' +
        '#wh-header {' +
        'display: flex;' +
        'justify-content: space-between;' +
        'align-items: center;' +
        'padding: 12px 15px;' +
        'background: rgba(0, 0, 0, 0.2);' +
        'color: white;' +
        'font-weight: bold;' +
        'font-size: 14px;' +
        'cursor: move;' +
        '}' +
        '#wh-toggle-btn {' +
        'background: rgba(255, 255, 255, 0.2);' +
        'border: none;' +
        'color: white;' +
        'width: 24px;' +
        'height: 24px;' +
        'border-radius: 50%;' +
        'cursor: pointer;' +
        'font-size: 16px;' +
        'line-height: 1;' +
        'transition: background 0.3s;' +
        '}' +
        '#wh-toggle-btn:hover {' +
        'background: rgba(255, 255, 255, 0.4);' +
        '}' +
        '#wh-content {' +
        'padding: 15px;' +
        'background: white;' +
        '}' +
        '#wh-content.collapsed {' +
        'display: none;' +
        '}' +
        '.wh-buttons {' +
        'display: flex;' +
        'flex-direction: column;' +
        'gap: 10px;' +
        '}' +
        '.wh-btn {' +
        'padding: 10px 15px;' +
        'border: none;' +
        'border-radius: 8px;' +
        'font-size: 13px;' +
        'font-weight: 600;' +
        'cursor: pointer;' +
        'transition: transform 0.2s, box-shadow 0.2s;' +
        '}' +
        '.wh-btn:hover {' +
        'transform: translateY(-2px);' +
        'box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);' +
        '}' +
        '.wh-btn:active {' +
        'transform: translateY(0);' +
        '}' +
        '.wh-btn-primary {' +
        'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);' +
        'color: white;' +
        '}' +
        '.wh-message {' +
        'padding: 10px 12px;' +
        'border-radius: 6px;' +
        'margin-bottom: 10px;' +
        'font-size: 12px;' +
        'font-weight: 500;' +
        'display: flex;' +
        'align-items: center;' +
        'gap: 6px;' +
        '}' +
        '.wh-message.success {' +
        'background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);' +
        'color: #155724;' +
        'border: 1px solid #c3e6cb;' +
        '}' +
        '.wh-message.error {' +
        'background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);' +
        'color: #721c24;' +
        'border: 1px solid #f5c6cb;' +
        '}' +
        '.wh-message.warning {' +
        'background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);' +
        'color: #856404;' +
        'border: 1px solid #ffeeba;' +
        '}' +
        '.wh-message.info {' +
        'background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);' +
        'color: #0c5460;' +
        'border: 1px solid #bee5eb;' +
        '}' +
        '.wh-hidden {' +
        'display: none !important;' +
        '}' +
        '.wh-visible {' +
        'display: flex !important;' +
        '}';

    // Th√™m CSS v√†o DOM - s·ª≠ d·ª•ng GM_addStyle n·∫øu c√≥, fallback sang style element
    if (typeof GM_addStyle !== 'undefined') {
        GM_addStyle(cssText);
    } else {
        var styles = document.createElement('style');
        styles.textContent = cssText;
        document.head.appendChild(styles);
    }
    document.body.appendChild(formContainer);

    // Toggle form content
    var toggleBtn = document.getElementById('wh-toggle-btn');
    var content = document.getElementById('wh-content');
    var isCollapsed = false;

    toggleBtn.addEventListener('click', function () {
        isCollapsed = !isCollapsed;
        if (isCollapsed) {
            content.classList.add('collapsed');
            toggleBtn.textContent = '+';
        }
        else {
            content.classList.remove('collapsed');
            toggleBtn.textContent = '‚àí';
        }
    });

    // Fill Human Info
    document.getElementById('wh-fill-human').addEventListener('click', function () {
        var billingName = document.getElementById('billingName');
        var billingAddressLine1 = document.getElementById('billingAddressLine1');
        var billingLocality = document.getElementById('billingLocality');
        var billingAdministrativeArea = document.getElementById('billingAdministrativeArea');
        var billingPostalCode = document.getElementById('billingPostalCode');

        var filledCount = 0;

        // H·ªç v√† t√™n
        if (billingName) {
            var randomFirstName = getRandomItem(firstNames);
            var randomLastName = getRandomItem(lastNames);
            setInputValue(billingName, randomFirstName + ' ' + randomLastName);
            filledCount++;
        }

        // Address line 1
        if (billingAddressLine1) {
            setInputValue(billingAddressLine1, generateRandomAddressLine());
            filledCount++;
        }

        // Th√†nh ph·ªë
        if (billingLocality) {
            setInputValue(billingLocality, generateRandomTwoWords());
            filledCount++;
        }

        // T·ªânh (SELECT element - ch·ªçn random option)
        if (billingAdministrativeArea) {
            if (billingAdministrativeArea.tagName === 'SELECT') {
                if (selectRandomOption(billingAdministrativeArea)) {
                    filledCount++;
                }
            } else {
                setInputValue(billingAdministrativeArea, generateRandomTwoWords());
                filledCount++;
            }
        }

        // M√£ b∆∞u ƒëi·ªán
        if (billingPostalCode) {
            setInputValue(billingPostalCode, getRandomPostalCode());
            filledCount++;
        }

        if (filledCount > 0) {
            showMessage('‚úÖ ƒê√£ ƒëi·ªÅn ' + filledCount + ' tr∆∞·ªùng th√†nh c√¥ng!', 'success');
            console.log('‚úÖ ƒê√£ ƒëi·ªÅn th√¥ng tin Human Info th√†nh c√¥ng!');
        } else {
            showMessage('‚ùå Kh√¥ng t√¨m th·∫•y c√°c input fields tr√™n trang!', 'error');
        }
    });

    console.log('‚úÖ Stripe Helper Form ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng!');
})();
