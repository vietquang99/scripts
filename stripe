// ==UserScript==
// @name         Stripe Form Helper
// @namespace    http://tampermonkey.net/
// @version      1.7
// @description  Hi·ªÉn th·ªã form h·ªó tr·ª£ tr√™n stripe.com (JS Style Properties ƒë·ªÉ bypass CSP)
// @author       You
// @match        https://*.stripe.com/*
// @match        https://pay.openai.com/*
// @grant        none
// @license MIT
// @copyright 2025, vietquang99 (https://openuserjs.org/users/vietquang99)
/* jshint esversion: 6 */
// ==/UserScript==

(function () {
    'use strict';

    // Danh s√°ch t√™n ng·∫´u nhi√™n
    var firstNames = ['John', 'Jane', 'Michael', 'Emily', 'David', 'Sarah', 'James', 'Emma', 'Robert', 'Olivia', 'William', 'Sophia', 'Daniel', 'Isabella', 'Matthew', 'Mia', 'Andrew', 'Charlotte', 'Joseph', 'Amelia'];
    var lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin'];

    // Danh s√°ch t·ª´ ng·∫´u nhi√™n cho ƒë·ªãa ch·ªâ
    var randomWords = ['Oak', 'Pine', 'Maple', 'Cedar', 'Elm', 'Birch', 'Willow', 'Ash', 'Cherry', 'Walnut', 'Spring', 'River', 'Lake', 'Hill', 'Valley', 'Forest', 'Meadow', 'Brook', 'Stone', 'Park', 'Green', 'Blue', 'Red', 'White', 'Black', 'North', 'South', 'East', 'West', 'Central'];

    // H√†m l·∫•y random item t·ª´ array
    function getRandomItem(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }

    // H√†m t·∫°o delay ng·∫´u nhi√™n
    function randomDelay(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // H√†m sleep
    function sleep(ms) {
        return new Promise(function(resolve) {
            setTimeout(resolve, ms);
        });
    }

    // H√†m simulate mouse events (click, focus)
    function simulateMouseEvents(element) {
        element.dispatchEvent(new MouseEvent('mousedown', { bubbles: true, cancelable: true, view: window }));
        element.dispatchEvent(new MouseEvent('mouseup', { bubbles: true, cancelable: true, view: window }));
        element.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
        element.focus();
        element.dispatchEvent(new FocusEvent('focus', { bubbles: true }));
        element.dispatchEvent(new FocusEvent('focusin', { bubbles: true }));
    }

    // H√†m simulate keyboard event cho t·ª´ng k√Ω t·ª±
    function simulateKeyEvents(element, char) {
        var keydownEvent = new KeyboardEvent('keydown', {
            key: char,
            code: 'Key' + char.toUpperCase(),
            charCode: char.charCodeAt(0),
            keyCode: char.charCodeAt(0),
            which: char.charCodeAt(0),
            bubbles: true
        });
        var keypressEvent = new KeyboardEvent('keypress', {
            key: char,
            code: 'Key' + char.toUpperCase(),
            charCode: char.charCodeAt(0),
            keyCode: char.charCodeAt(0),
            which: char.charCodeAt(0),
            bubbles: true
        });
        var keyupEvent = new KeyboardEvent('keyup', {
            key: char,
            code: 'Key' + char.toUpperCase(),
            charCode: char.charCodeAt(0),
            keyCode: char.charCodeAt(0),
            which: char.charCodeAt(0),
            bubbles: true
        });
        
        element.dispatchEvent(keydownEvent);
        element.dispatchEvent(keypressEvent);
        element.dispatchEvent(keyupEvent);
    }

    // H√†m nh·∫≠p t·ª´ng k√Ω t·ª± m·ªôt c√°ch t·ª± nhi√™n (gi·ªëng ng∆∞·ªùi th·∫≠t)
    async function typeHumanLike(element, value) {
        // Clear gi√° tr·ªã hi·ªán t·∫°i
        var prototype;
        if (element.tagName === 'SELECT') {
            prototype = window.HTMLSelectElement.prototype;
        } else if (element.tagName === 'TEXTAREA') {
            prototype = window.HTMLTextAreaElement.prototype;
        } else {
            prototype = window.HTMLInputElement.prototype;
        }
        
        var nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value');
        if (nativeValueSetter && nativeValueSetter.set) {
            nativeValueSetter.set.call(element, '');
        } else {
            element.value = '';
        }
        element.dispatchEvent(new Event('input', { bubbles: true }));
        
        // Nh·∫≠p t·ª´ng k√Ω t·ª±
        var currentValue = '';
        for (var i = 0; i < value.length; i++) {
            var char = value[i];
            currentValue += char;
            
            // Simulate keyboard events
            simulateKeyEvents(element, char);
            
            // Set value
            if (nativeValueSetter && nativeValueSetter.set) {
                nativeValueSetter.set.call(element, currentValue);
            } else {
                element.value = currentValue;
            }
            
            // Dispatch input event
            element.dispatchEvent(new Event('input', { bubbles: true }));
            
            // Delay ng·∫´u nhi√™n gi·ªØa c√°c k√Ω t·ª± (50-150ms, gi·ªëng t·ªëc ƒë·ªô g√µ c·ªßa ng∆∞·ªùi)
            await sleep(randomDelay(50, 150));
        }
        
        // Dispatch change event sau khi ho√†n th√†nh
        element.dispatchEvent(new Event('change', { bubbles: true }));
        element.dispatchEvent(new FocusEvent('blur', { bubbles: true }));
    }

    // H√†m click v√†o element v√† ch·ªù m·ªôt ch√∫t tr∆∞·ªõc khi nh·∫≠p
    async function clickAndType(element, value) {
        // Simulate click v√† focus
        simulateMouseEvents(element);
        
        // Ch·ªù m·ªôt ch√∫t sau khi click (nh∆∞ ng∆∞·ªùi th·∫≠t)
        await sleep(randomDelay(200, 400));
        
        // Nh·∫≠p t·ª´ng k√Ω t·ª±
        await typeHumanLike(element, value);
        
        // Ch·ªù m·ªôt ch√∫t sau khi nh·∫≠p xong
        await sleep(randomDelay(100, 300));
    }

    // H√†m simulate input event (ƒë·ªÉ trigger React/Vue state update)
    function setInputValue(element, value) {
        var prototype;
        if (element.tagName === 'SELECT') {
            prototype = window.HTMLSelectElement.prototype;
        } else if (element.tagName === 'TEXTAREA') {
            prototype = window.HTMLTextAreaElement.prototype;
        } else {
            prototype = window.HTMLInputElement.prototype;
        }
        
        var nativeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value');
        if (nativeValueSetter && nativeValueSetter.set) {
            nativeValueSetter.set.call(element, value);
        } else {
            element.value = value;
        }
        
        element.dispatchEvent(new Event('input', { bubbles: true }));
        element.dispatchEvent(new Event('change', { bubbles: true }));
    }

    // H√†m t·∫°o random s·ªë
    function getRandomNumbers(length) {
        var result = '';
        for (var i = 0; i < length; i++) {
            result += Math.floor(Math.random() * 10);
        }
        return result;
    }

    // H√†m t·∫°o random s·ªë b·∫Øt ƒë·∫ßu t·ª´ 0 ho·∫∑c 1
    function getRandomPostalCode() {
        var firstDigit = Math.random() < 0.5 ? '0' : '1';
        return firstDigit + getRandomNumbers(5);
    }

    // H√†m t·∫°o random address line (1-3 s·ªë + 2 t·ª´)
    function generateRandomAddressLine() {
        var numCount = Math.floor(Math.random() * 3) + 1;
        var numbers = '';
        for (var i = 0; i < numCount; i++) {
            numbers += Math.floor(Math.random() * 10);
        }
        var word1 = getRandomItem(randomWords);
        var word2 = getRandomItem(randomWords);
        return numbers + ' ' + word1 + ' ' + word2;
    }

    // H√†m t·∫°o random 2 t·ª´
    function generateRandomTwoWords() {
        var word1 = getRandomItem(randomWords);
        var word2 = getRandomItem(randomWords);
        return word1 + ' ' + word2;
    }

    // H√†m ch·ªçn random option trong SELECT element
    function selectRandomOption(selectElement) {
        var options = selectElement.options;
        if (options.length <= 1) return false;
        
        var startIndex = 0;
        if (options[0].value === '' || options[0].disabled) {
            startIndex = 1;
        }
        
        if (startIndex >= options.length) return false;
        
        var randomIndex = startIndex + Math.floor(Math.random() * (options.length - startIndex));
        selectElement.selectedIndex = randomIndex;
        
        selectElement.dispatchEvent(new Event('change', { bubbles: true }));
        selectElement.dispatchEvent(new Event('input', { bubbles: true }));
        
        return true;
    }

    // H√†m x√°c ƒë·ªãnh lo·∫°i th·∫ª d·ª±a tr√™n BIN
    function getCardType(bin) {
        bin = bin.replace(/\D/g, ''); // Ch·ªâ l·∫•y s·ªë
        if (!bin) return null;
        
        var firstDigit = bin.charAt(0);
        var first2 = bin.substring(0, 2);
        var first3 = bin.substring(0, 3);
        var first4 = bin.substring(0, 4);
        var first6 = bin.substring(0, 6);
        
        // Visa: b·∫Øt ƒë·∫ßu b·∫±ng 4, ƒë·ªô d√†i 16
        if (firstDigit === '4') {
            return { type: 'Visa', length: 16, cvvLength: 3 };
        }
        
        // American Express: b·∫Øt ƒë·∫ßu b·∫±ng 34 ho·∫∑c 37, ƒë·ªô d√†i 15
        if (first2 === '34' || first2 === '37') {
            return { type: 'Amex', length: 15, cvvLength: 4 };
        }
        
        // Mastercard: 51-55 ho·∫∑c 2221-2720, ƒë·ªô d√†i 16
        var first2Num = parseInt(first2);
        var first4Num = parseInt(first4);
        if ((first2Num >= 51 && first2Num <= 55) || (first4Num >= 2221 && first4Num <= 2720)) {
            return { type: 'Mastercard', length: 16, cvvLength: 3 };
        }
        
        // Discover: 6011, 622126-622925, 644-649, 65, ƒë·ªô d√†i 16
        var first3Num = parseInt(first3);
        var first6Num = parseInt(first6);
        if (first4 === '6011' || first2 === '65' || 
            (first3Num >= 644 && first3Num <= 649) ||
            (first6Num >= 622126 && first6Num <= 622925)) {
            return { type: 'Discover', length: 16, cvvLength: 3 };
        }
        
        // JCB: 3528-3589, ƒë·ªô d√†i 16
        if (first4Num >= 3528 && first4Num <= 3589) {
            return { type: 'JCB', length: 16, cvvLength: 3 };
        }
        
        // Diners Club: 300-305, 36, 38, ƒë·ªô d√†i 14
        if ((first3Num >= 300 && first3Num <= 305) || first2 === '36' || first2 === '38') {
            return { type: 'Diners', length: 14, cvvLength: 3 };
        }
        
        // UnionPay: b·∫Øt ƒë·∫ßu b·∫±ng 62, ƒë·ªô d√†i 16
        if (first2 === '62') {
            return { type: 'UnionPay', length: 16, cvvLength: 3 };
        }
        
        // M·∫∑c ƒë·ªãnh: 16 s·ªë, CVV 3 s·ªë
        return { type: 'Unknown', length: 16, cvvLength: 3 };
    }

    // H√†m t√≠nh Luhn check digit
    function calculateLuhnCheckDigit(partialNumber) {
        var digits = partialNumber.split('').map(Number);
        var sum = 0;
        var isEven = true; // V√¨ ta ƒëang t√≠nh t·ª´ ph·∫£i sang tr√°i, v√† check digit ·ªü v·ªã tr√≠ cu·ªëi
        
        // Duy·ªát t·ª´ ph·∫£i sang tr√°i (kh√¥ng bao g·ªìm check digit)
        for (var i = digits.length - 1; i >= 0; i--) {
            var digit = digits[i];
            
            if (isEven) {
                digit *= 2;
                if (digit > 9) {
                    digit -= 9;
                }
            }
            
            sum += digit;
            isEven = !isEven;
        }
        
        // Check digit l√† s·ªë c·∫ßn th√™m ƒë·ªÉ t·ªïng chia h·∫øt cho 10
        var checkDigit = (10 - (sum % 10)) % 10;
        return checkDigit;
    }

    // H√†m ki·ªÉm tra s·ªë th·∫ª h·ª£p l·ªá theo Luhn
    function isValidLuhn(cardNumber) {
        var digits = cardNumber.replace(/\D/g, '').split('').map(Number);
        var sum = 0;
        var isEven = false;
        
        for (var i = digits.length - 1; i >= 0; i--) {
            var digit = digits[i];
            
            if (isEven) {
                digit *= 2;
                if (digit > 9) {
                    digit -= 9;
                }
            }
            
            sum += digit;
            isEven = !isEven;
        }
        
        return sum % 10 === 0;
    }

    // H√†m t·∫°o s·ªë th·∫ª ƒë·∫ßy ƒë·ªß t·ª´ BIN (s·ª≠ d·ª•ng thu·∫≠t to√°n Luhn)
    function generateFullCardNumber(bin, cardLength) {
        bin = bin.replace(/\D/g, '');
        
        // N·∫øu ƒë√£ ƒë·ªß ƒë·ªô d√†i, ki·ªÉm tra v√† tr·∫£ v·ªÅ
        if (bin.length >= cardLength) {
            return bin.substring(0, cardLength);
        }
        
        // T·∫°o s·ªë ng·∫´u nhi√™n cho c√°c ch·ªØ s·ªë c√≤n thi·∫øu (tr·ª´ check digit)
        var remaining = cardLength - bin.length - 1; // -1 cho check digit
        var partialNumber = bin;
        
        for (var i = 0; i < remaining; i++) {
            partialNumber += Math.floor(Math.random() * 10);
        }
        
        // T√≠nh check digit theo Luhn
        var checkDigit = calculateLuhnCheckDigit(partialNumber);
        
        return partialNumber + checkDigit;
    }

    // H√†m t·∫°o random CVV
    function generateRandomCVV(length) {
        var cvv = '';
        for (var i = 0; i < length; i++) {
            cvv += Math.floor(Math.random() * 10);
        }
        return cvv;
    }

    // H√†m t·∫°o random expiry (MM/YY)
    function generateRandomExpiry(month, year) {
        var m = month;
        var y = year;
        
        if (!m || m === 'random') {
            m = String(Math.floor(Math.random() * 12) + 1).padStart(2, '0');
        }
        
        if (!y || y === 'random') {
            var currentYear = new Date().getFullYear() % 100;
            y = String(currentYear + Math.floor(Math.random() * 5) + 1); // 1-5 nƒÉm t·ªõi
        }
        
        return m + '/' + y;
    }

    // H√†m apply styles b·∫±ng JS properties (bypass CSP)
    function applyStyles(element, styles) {
        for (var prop in styles) {
            if (styles.hasOwnProperty(prop)) {
                element.style[prop] = styles[prop];
            }
        }
    }

    // Bi·∫øn ƒë·ªÉ l∆∞u reference
    var messageEl = null;
    var contentEl = null;

    // H√†m hi·ªÉn th·ªã th√¥ng b√°o tr√™n UI
    function showMessage(message, type, duration) {
        type = type || 'info';
        duration = duration || 3000;

        if (!messageEl) return;

        messageEl.textContent = message;
        
        // Apply styles based on type
        var colors = {
            success: { bg: '#d4edda', color: '#155724', border: '#c3e6cb' },
            error: { bg: '#f8d7da', color: '#721c24', border: '#f5c6cb' },
            warning: { bg: '#fff3cd', color: '#856404', border: '#ffeeba' },
            info: { bg: '#d1ecf1', color: '#0c5460', border: '#bee5eb' }
        };
        
        var c = colors[type] || colors.info;
        applyStyles(messageEl, {
            display: 'block',
            background: c.bg,
            color: c.color,
            border: '1px solid ' + c.border
        });

        if (duration > 0) {
            setTimeout(function () {
                applyStyles(messageEl, { display: 'none' });
            }, duration);
        }
    }

    // T·∫°o UI elements b·∫±ng JavaScript (kh√¥ng d√πng innerHTML v·ªõi styles)
    function createUI() {
        // Host container
        var host = document.createElement('div');
        host.id = 'stripe-helper-host';
        applyStyles(host, {
            position: 'fixed',
            bottom: '10px',
            right: '10px',
            zIndex: '2147483647',
            fontFamily: '"Segoe UI", Tahoma, Geneva, Verdana, sans-serif'
        });

        // Form wrapper
        var wrapper = document.createElement('div');
        applyStyles(wrapper, {
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            borderRadius: '12px',
            boxShadow: '0 10px 40px rgba(0, 0, 0, 0.3)',
            overflow: 'hidden',
            minWidth: '280px',
            maxWidth: '320px'
        });

        // Header
        var header = document.createElement('div');
        applyStyles(header, {
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            padding: '12px 15px',
            background: 'rgba(0, 0, 0, 0.2)',
            color: 'white',
            fontWeight: 'bold',
            fontSize: '14px',
            cursor: 'move'
        });

        // Header title
        var title = document.createElement('span');
        title.textContent = 'üí≥ Stripe Helper';

        // Toggle button
        var toggleBtn = document.createElement('button');
        toggleBtn.textContent = '‚àí';
        applyStyles(toggleBtn, {
            background: 'rgba(255, 255, 255, 0.2)',
            border: 'none',
            color: 'white',
            width: '24px',
            height: '24px',
            borderRadius: '50%',
            cursor: 'pointer',
            fontSize: '16px',
            lineHeight: '1'
        });

        header.appendChild(title);
        header.appendChild(toggleBtn);

        // Content
        contentEl = document.createElement('div');
        applyStyles(contentEl, {
            padding: '15px',
            background: 'white'
        });

        // Message element
        messageEl = document.createElement('div');
        applyStyles(messageEl, {
            display: 'none',
            padding: '10px 12px',
            borderRadius: '6px',
            marginBottom: '10px',
            fontSize: '12px',
            fontWeight: '500'
        });

        // Buttons container
        var buttonsDiv = document.createElement('div');
        applyStyles(buttonsDiv, {
            display: 'flex',
            flexDirection: 'column',
            gap: '10px'
        });

        // Fill Human Info button
        var fillBtn = document.createElement('button');
        fillBtn.textContent = 'Fill Human Info';
        applyStyles(fillBtn, {
            padding: '10px 15px',
            border: 'none',
            borderRadius: '8px',
            fontSize: '13px',
            fontWeight: '600',
            cursor: 'pointer',
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            color: 'white'
        });

        // Hover effects
        fillBtn.addEventListener('mouseenter', function() {
            applyStyles(this, {
                transform: 'translateY(-2px)',
                boxShadow: '0 4px 12px rgba(0, 0, 0, 0.2)'
            });
        });
        fillBtn.addEventListener('mouseleave', function() {
            applyStyles(this, {
                transform: 'translateY(0)',
                boxShadow: 'none'
            });
        });

        toggleBtn.addEventListener('mouseenter', function() {
            applyStyles(this, { background: 'rgba(255, 255, 255, 0.4)' });
        });
        toggleBtn.addEventListener('mouseleave', function() {
            applyStyles(this, { background: 'rgba(255, 255, 255, 0.2)' });
        });

        // Toggle functionality
        var isCollapsed = false;
        toggleBtn.addEventListener('click', function() {
            isCollapsed = !isCollapsed;
            if (isCollapsed) {
                applyStyles(contentEl, { display: 'none' });
                toggleBtn.textContent = '+';
            } else {
                applyStyles(contentEl, { display: 'block' });
                toggleBtn.textContent = '‚àí';
            }
        });

        // Fill Human Info click handler (Human-like typing)
        fillBtn.addEventListener('click', async function() {
            var billingName = document.getElementById('billingName');
            var billingAddressLine1 = document.getElementById('billingAddressLine1');
            var billingLocality = document.getElementById('billingLocality');
            var billingAdministrativeArea = document.getElementById('billingAdministrativeArea');
            var billingPostalCode = document.getElementById('billingPostalCode');

            var filledCount = 0;
            
            // Disable button trong khi ƒëang nh·∫≠p
            fillBtn.disabled = true;
            fillBtn.textContent = 'ƒêang nh·∫≠p...';
            applyStyles(fillBtn, { opacity: '0.7', cursor: 'not-allowed' });

            try {
                if (billingName) {
                    var randomFirstName = getRandomItem(firstNames);
                    var randomLastName = getRandomItem(lastNames);
                    await clickAndType(billingName, randomFirstName + ' ' + randomLastName);
                    filledCount++;
                    
                    // Delay gi·ªØa c√°c tr∆∞·ªùng (nh∆∞ ng∆∞·ªùi th·∫≠t di chuy·ªÉn chu·ªôt)
                    await sleep(randomDelay(100, 200));
                }

                if (billingAddressLine1) {
                    await clickAndType(billingAddressLine1, generateRandomAddressLine());
                    filledCount++;
                    await sleep(randomDelay(100, 200));
                }

                if (billingLocality) {
                    await clickAndType(billingLocality, generateRandomTwoWords());
                    filledCount++;
                    await sleep(randomDelay(100, 200));
                }

                if (billingAdministrativeArea) {
                    if (billingAdministrativeArea.tagName === 'SELECT') {
                        // Click v√†o select tr∆∞·ªõc
                        simulateMouseEvents(billingAdministrativeArea);
                        await sleep(randomDelay(100, 200));
                        
                        if (selectRandomOption(billingAdministrativeArea)) {
                            filledCount++;
                        }
                        await sleep(randomDelay(100, 200));
                    } else {
                        await clickAndType(billingAdministrativeArea, generateRandomTwoWords());
                        filledCount++;
                        await sleep(randomDelay(100, 200));
                    }
                }

                if (billingPostalCode) {
                    await clickAndType(billingPostalCode, getRandomPostalCode());
                    filledCount++;
                }

                if (filledCount > 0) {
                    showMessage('‚úÖ ƒê√£ ƒëi·ªÅn ' + filledCount + ' tr∆∞·ªùng th√†nh c√¥ng!', 'success');
                    console.log('‚úÖ ƒê√£ ƒëi·ªÅn th√¥ng tin Human Info th√†nh c√¥ng!');
                } else {
                    showMessage('‚ùå Kh√¥ng t√¨m th·∫•y c√°c input fields tr√™n trang!', 'error');
                }
            } catch (error) {
                console.error('L·ªói khi ƒëi·ªÅn form:', error);
                showMessage('‚ùå C√≥ l·ªói x·∫£y ra: ' + error.message, 'error');
            } finally {
                // Enable l·∫°i button
                fillBtn.disabled = false;
                fillBtn.textContent = 'Fill Human Info';
                applyStyles(fillBtn, { opacity: '1', cursor: 'pointer' });
            }
        });

        // ===== CARD SECTION =====
        // Separator
        var separator = document.createElement('hr');
        applyStyles(separator, {
            border: 'none',
            borderTop: '1px solid #e0e0e0',
            margin: '15px 0'
        });

        // Card section title
        var cardTitle = document.createElement('div');
        cardTitle.textContent = 'üí≥ Card Info';
        applyStyles(cardTitle, {
            fontWeight: 'bold',
            fontSize: '13px',
            color: '#333',
            marginBottom: '10px'
        });

        // BIN Input
        var binLabel = document.createElement('label');
        binLabel.textContent = 'BIN / Card Number:';
        applyStyles(binLabel, {
            display: 'block',
            fontSize: '12px',
            fontWeight: '600',
            color: '#555',
            marginBottom: '4px'
        });

        var binInput = document.createElement('input');
        binInput.type = 'text';
        binInput.placeholder = 'Nh·∫≠p BIN ho·∫∑c s·ªë th·∫ª ƒë·∫ßy ƒë·ªß...';
        applyStyles(binInput, {
            width: '100%',
            padding: '8px 10px',
            border: '2px solid #e0e0e0',
            borderRadius: '6px',
            fontSize: '13px',
            boxSizing: 'border-box',
            marginBottom: '10px'
        });

        // Expiry Row
        var expiryRow = document.createElement('div');
        applyStyles(expiryRow, {
            display: 'flex',
            gap: '10px',
            marginBottom: '10px'
        });

        // Month select
        var monthDiv = document.createElement('div');
        applyStyles(monthDiv, { flex: '1' });
        
        var monthLabel = document.createElement('label');
        monthLabel.textContent = 'Th√°ng:';
        applyStyles(monthLabel, {
            display: 'block',
            fontSize: '11px',
            fontWeight: '600',
            color: '#555',
            marginBottom: '4px'
        });

        var monthSelect = document.createElement('select');
        applyStyles(monthSelect, {
            width: '100%',
            padding: '6px',
            border: '2px solid #e0e0e0',
            borderRadius: '6px',
            fontSize: '12px',
            background: 'white'
        });
        
        var monthOptions = [{ value: 'random', text: 'Random' }];
        for (var m = 1; m <= 12; m++) {
            monthOptions.push({ value: String(m).padStart(2, '0'), text: String(m).padStart(2, '0') });
        }
        monthOptions.forEach(function(opt) {
            var option = document.createElement('option');
            option.value = opt.value;
            option.textContent = opt.text;
            monthSelect.appendChild(option);
        });

        monthDiv.appendChild(monthLabel);
        monthDiv.appendChild(monthSelect);

        // Year select
        var yearDiv = document.createElement('div');
        applyStyles(yearDiv, { flex: '1' });
        
        var yearLabel = document.createElement('label');
        yearLabel.textContent = 'NƒÉm:';
        applyStyles(yearLabel, {
            display: 'block',
            fontSize: '11px',
            fontWeight: '600',
            color: '#555',
            marginBottom: '4px'
        });

        var yearSelect = document.createElement('select');
        applyStyles(yearSelect, {
            width: '100%',
            padding: '6px',
            border: '2px solid #e0e0e0',
            borderRadius: '6px',
            fontSize: '12px',
            background: 'white'
        });
        
        var currentYear = new Date().getFullYear() % 100;
        var yearOptions = [{ value: 'random', text: 'Random' }];
        for (var y = 0; y <= 10; y++) {
            var yr = String(currentYear + y + 2);
            yearOptions.push({ value: yr, text: yr });
        }
        yearOptions.forEach(function(opt) {
            var option = document.createElement('option');
            option.value = opt.value;
            option.textContent = opt.text;
            yearSelect.appendChild(option);
        });

        yearDiv.appendChild(yearLabel);
        yearDiv.appendChild(yearSelect);

        expiryRow.appendChild(monthDiv);
        expiryRow.appendChild(yearDiv);

        // CVV Input
        var cvvDiv = document.createElement('div');
        applyStyles(cvvDiv, { flex: '1' });
        
        var cvvLabel = document.createElement('label');
        cvvLabel.textContent = 'CVV:';
        applyStyles(cvvLabel, {
            display: 'block',
            fontSize: '11px',
            fontWeight: '600',
            color: '#555',
            marginBottom: '4px'
        });

        var cvvInput = document.createElement('input');
        cvvInput.type = 'text';
        cvvInput.placeholder = 'Random';
        applyStyles(cvvInput, {
            width: '100%',
            padding: '6px',
            border: '2px solid #e0e0e0',
            borderRadius: '6px',
            fontSize: '12px',
            boxSizing: 'border-box',
            marginBottom: '10px'
        });

        // Fill Card button
        var fillCardBtn = document.createElement('button');
        fillCardBtn.textContent = 'Fill Card Info';
        applyStyles(fillCardBtn, {
            padding: '10px 15px',
            border: 'none',
            borderRadius: '8px',
            fontSize: '13px',
            fontWeight: '600',
            cursor: 'pointer',
            background: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
            color: 'white',
            width: '100%'
        });

        // Hover effects for Fill Card button
        fillCardBtn.addEventListener('mouseenter', function() {
            applyStyles(this, {
                transform: 'translateY(-2px)',
                boxShadow: '0 4px 12px rgba(0, 0, 0, 0.2)'
            });
        });
        fillCardBtn.addEventListener('mouseleave', function() {
            applyStyles(this, {
                transform: 'translateY(0)',
                boxShadow: 'none'
            });
        });

        // Fill Card click handler
        fillCardBtn.addEventListener('click', function() {
            var cardNumberEl = document.getElementById('cardNumber');
            var cardExpiryEl = document.getElementById('cardExpiry');
            var cardCvcEl = document.getElementById('cardCvc');

            var filledCount = 0;
            var bin = binInput.value.trim();
            
            // X√°c ƒë·ªãnh lo·∫°i th·∫ª
            var cardType = getCardType(bin || '4'); // M·∫∑c ƒë·ªãnh Visa n·∫øu kh√¥ng c√≥ BIN
            if (!bin) {
                bin = '4'; // M·∫∑c ƒë·ªãnh Visa
            }

            // Fill card number
            if (cardNumberEl) {
                var fullCardNumber = generateFullCardNumber(bin, cardType.length);
                setInputValue(cardNumberEl, fullCardNumber);
                filledCount++;
            }

            // Fill expiry
            if (cardExpiryEl) {
                var month = monthSelect.value;
                var year = yearSelect.value;
                var expiry = generateRandomExpiry(month, year);
                setInputValue(cardExpiryEl, expiry);
                filledCount++;
            }

            // Fill CVV
            if (cardCvcEl) {
                var cvv = cvvInput.value.trim();
                if (!cvv) {
                    cvv = generateRandomCVV(cardType.cvvLength);
                }
                setInputValue(cardCvcEl, cvv);
                filledCount++;
            }

            if (filledCount > 0) {
                showMessage('‚úÖ ƒê√£ ƒëi·ªÅn ' + filledCount + ' tr∆∞·ªùng th·∫ª! (' + cardType.type + ')', 'success');
                console.log('‚úÖ Card type:', cardType.type, '- Filled:', filledCount);
            } else {
                showMessage('‚ùå Kh√¥ng t√¨m th·∫•y c√°c input th·∫ª tr√™n trang!', 'error');
            }
        });

        // Assemble UI
        buttonsDiv.appendChild(fillBtn);
        
        // Card section
        buttonsDiv.appendChild(separator);
        buttonsDiv.appendChild(cardTitle);
        buttonsDiv.appendChild(binLabel);
        buttonsDiv.appendChild(binInput);
        buttonsDiv.appendChild(expiryRow);
        buttonsDiv.appendChild(cvvLabel);
        buttonsDiv.appendChild(cvvInput);
        buttonsDiv.appendChild(fillCardBtn);

        contentEl.appendChild(messageEl);
        contentEl.appendChild(buttonsDiv);
        wrapper.appendChild(header);
        wrapper.appendChild(contentEl);
        host.appendChild(wrapper);

        return host;
    }

    // Ch·ªù DOM ready r·ªìi t·∫°o UI
    if (document.body) {
        document.body.appendChild(createUI());
        console.log('‚úÖ Stripe Helper Form ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng! (JS Style Properties)');
    } else {
        document.addEventListener('DOMContentLoaded', function() {
            document.body.appendChild(createUI());
            console.log('‚úÖ Stripe Helper Form ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng! (JS Style Properties)');
        });
    }
})();
