// ==UserScript==
// @name         Windsurf Form Helper
// @namespace    http://tampermonkey.net/
// @version      1.7
// @description  Hi·ªÉn th·ªã form h·ªó tr·ª£ tr√™n windsurf.com
// @author       You
// @match        https://*.windsurf.com/*
// @match        https://windsurf.com/*
// @grant        none
// @license MIT
// @copyright 2025, vietquang99 (https://openuserjs.org/users/vietquang99)
/* jshint esversion: 6 */
// ==/UserScript==

(function () {
  'use strict';

  // Danh s√°ch t√™n ng·∫´u nhi√™n
  var firstNames = ['John', 'Jane', 'Michael', 'Emily', 'David', 'Sarah', 'James', 'Emma', 'Robert', 'Olivia', 'William', 'Sophia', 'Daniel', 'Isabella', 'Matthew', 'Mia', 'Andrew', 'Charlotte', 'Joseph', 'Amelia'];
  var lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin'];

  // Password m·∫∑c ƒë·ªãnh
  var DEFAULT_PASSWORD = 'Qwert113@@@';

  // Danh s√°ch domain c·∫ßn ignore
  var IGNORE_DOMAINS = ['idebattisti.com', 'g2italia.net','rvcisp.com','dj-fs.com','ocramnaig.com','deyit.com'];

  // H√†m l·∫•y random item t·ª´ array
  function getRandomItem(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // H√†m simulate input event (ƒë·ªÉ trigger React/Vue state update)
  function setInputValue(element, value) {
    var nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;
    nativeInputValueSetter.call(element, value);
    element.dispatchEvent(new Event('input', {
      bubbles: true
    }));
    element.dispatchEvent(new Event('change', {
      bubbles: true
    }));
  }

  // H√†m t·∫°o random s·ªë
  function getRandomNumbers(length) {
    var result = '';
    for (var i = 0; i < length; i++) {
      result += Math.floor(Math.random() * 10);
    }
    return result;
  }

  // H√†m t·∫°o random username
  function generateRandomUsername() {
    var firstName = getRandomItem(firstNames).toLowerCase();
    var lastName = getRandomItem(lastNames).toLowerCase();
    var numbers = getRandomNumbers(4);
    return firstName + lastName + numbers;
  }

  // H√†m g·ªçi API l·∫•y random domains
  async function fetchRandomDomains() {
    try {
      var response = await fetch('https://nguyenngocanhtu.com/api/random-domains/?limit=1');
      if (!response.ok) {
        throw new Error('API request failed');
      }
      var data = await response.json();
      return data.domains || [];
    } catch (error) {
      console.error('‚ùå L·ªói khi g·ªçi API:', error);
      return [];
    }
  }

  // H√†m l·∫•y domain h·ª£p l·ªá (kh√¥ng thu·ªôc ignore list)
  async function getValidDomain() {
    var maxAttempts = 10; // Gi·ªõi h·∫°n s·ªë l·∫ßn th·ª≠ ƒë·ªÉ tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n
    var attempts = 0;

    while (attempts < maxAttempts) {
      var domains = await fetchRandomDomains();

      if (domains.length === 0) {
        console.log('‚ö†Ô∏è Kh√¥ng l·∫•y ƒë∆∞·ª£c domain t·ª´ API');
        attempts++;
        continue;
      }

      // L·ªçc c√°c domain kh√¥ng thu·ªôc ignore list
      var validDomains = domains.filter(function (domain) {
        return IGNORE_DOMAINS.indexOf(domain) === -1;
      });

      if (validDomains.length > 0) {
        // L·∫•y random 1 domain t·ª´ danh s√°ch h·ª£p l·ªá
        return getRandomItem(validDomains);
      }

      console.log('‚ö†Ô∏è T·∫•t c·∫£ domain ƒë·ªÅu thu·ªôc ignore list, th·ª≠ l·∫°i...');
      attempts++;
    }

    throw new Error('Kh√¥ng th·ªÉ l·∫•y ƒë∆∞·ª£c domain h·ª£p l·ªá sau ' + maxAttempts + ' l·∫ßn th·ª≠');
  }

  // H√†m copy text v√†o clipboard
  function copyToClipboard(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function () {
        console.log('‚úÖ ƒê√£ copy: ' + text);
        showMessage('‚úÖ ƒê√£ copy email url!', 'success');
      }).catch(function (err) {
        console.error('‚ùå L·ªói khi copy:', err);
        showMessage('‚ùå L·ªói khi copy!', 'error');
      });
    } else {
      // Fallback cho c√°c tr√¨nh duy·ªát c≈©
      var textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        console.log('‚úÖ ƒê√£ copy: ' + text);
        showMessage('‚úÖ ƒê√£ copy email url!', 'success');
      } catch (err) {
        console.error('‚ùå L·ªói khi copy:', err);
        showMessage('‚ùå L·ªói khi copy!', 'error');
      }
      document.body.removeChild(textArea);
    }
  }

  // H√†m hi·ªÉn th·ªã th√¥ng b√°o tr√™n UI
  function showMessage(message, type, duration) {
    type = type || 'info';
    duration = duration || 3000;

    var messageEl = document.getElementById('wh-message');
    if (!messageEl) return;

    // X√≥a c√°c class type c≈©
    messageEl.className = 'wh-message';
    messageEl.classList.add(type);
    messageEl.textContent = message;
    messageEl.style.display = 'flex';

    // T·ª± ƒë·ªông ·∫©n sau duration ms
    if (duration > 0) {
      setTimeout(function () {
        messageEl.style.display = 'none';
      }, duration);
    }
  }

  // H√†m click checkbox
  function setCheckbox(element, checked) {
    if (element.checked !== checked) {
      element.click();
    }
  }

  // H√†m click button Continue
  function clickContinueButton() {
    setTimeout(function () {
      var continueBtn = document.querySelector('button.bg-sk-aqua');

      if (continueBtn && !continueBtn.disabled) {
        continueBtn.click();
        console.log('‚úÖ ƒê√£ click button Continue');
      }
      else {
        console.log('‚ö†Ô∏è Button Continue ƒëang disabled ho·∫∑c kh√¥ng t√¨m th·∫•y');
      }
    }, 300);
  }

  // T·∫°o container cho form
  var formContainer = document.createElement('div');
  formContainer.id = 'windsurf-helper-form';
  formContainer.innerHTML =
    '<div id="wh-form-wrapper">' +
    '<div id="wh-header">' +
    '<span>üèÑ Windsurf Helper</span>' +
    '<button id="wh-toggle-btn">‚àí</button>' +
    '</div>' +
    '<div id="wh-content">' +
    '<div class="wh-field">' +
    '<label for="wh-email">Email:</label>' +
    '<input type="email" id="wh-email" placeholder="Nh·∫≠p email c·ªßa b·∫°n...">' +
    '<div id="wh-email-url-container" style="display: none; margin-top: 8px; padding: 8px; background: #f0f0f0; border-radius: 6px;">' +
    '<div style="display: flex; align-items: center; justify-content: space-between;">' +
    '<span id="wh-email-url-label" style="font-size: 12px; color: #555; word-break: break-all;"></span>' +
    '<button id="wh-copy-email" title="Copy Email" style="background: transparent; border: none; cursor: pointer; font-size: 18px; padding: 4px 8px; margin-left: 8px;">üìã</button>' +
    '</div>' +
    '</div>' +
    '</div>' +
    '<div id="wh-otp-container" style="display: none; margin-top: 8px; padding: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 6px;">' +
    '<div style="display: flex; align-items: center; justify-content: space-between;">' +
    '<span id="wh-otp-label" style="font-size: 16px; color: white; font-weight: bold;"></span>' +
    '<button id="wh-copy-otp" title="Copy OTP" style="background: rgba(255,255,255,0.2); border: none; cursor: pointer; font-size: 16px; padding: 6px 10px; border-radius: 4px; color: white;">üìã</button>' +
    '</div>' +
    '</div>' +
    '<div id="wh-message" class="wh-message" style="display: none;"></div>' +
    '<div class="wh-buttons">' +
    '<button id="wh-generate-email" class="wh-btn wh-btn-success">Generate Random Email</button>' +
    '<button id="wh-fill-random" class="wh-btn wh-btn-primary">Fill Random Info</button>' +
    '<button id="wh-fill-password" class="wh-btn wh-btn-secondary">Fill Password</button>' +
    '<button id="wh-fill-otp" class="wh-btn wh-btn-info">Fill OTP</button>' +
    '</div>' +
    '</div>' +
    '</div>';

  // CSS styles
  var styles = document.createElement('style');
  styles.textContent =
    '#windsurf-helper-form {' +
    'position: fixed;' +
    'bottom: 10px;' +
    'right: 10px;' +
    'z-index: 999999;' +
    'font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;' +
    '}' +
    '#wh-form-wrapper {' +
    'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);' +
    'border-radius: 12px;' +
    'box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);' +
    'overflow: hidden;' +
    'min-width: 280px;' +
    'max-width: 320px;' +
    '}' +
    '@media (max-width: 480px) {' +
    '#wh-form-wrapper {' +
    'min-width: 200px;' +
    'max-width: 220px;' +
    '}' +
    '#wh-header {' +
    'padding: 8px 10px;' +
    'font-size: 12px;' +
    '}' +
    '#wh-content {' +
    'padding: 10px;' +
    '}' +
    '.wh-field label {' +
    'font-size: 11px;' +
    '}' +
    '.wh-field input {' +
    'padding: 6px 8px;' +
    'font-size: 12px;' +
    '}' +
    '.wh-btn {' +
    'padding: 6px 10px;' +
    'font-size: 11px;' +
    '}' +
    '#wh-email-url-container {' +
    'padding: 6px !important;' +
    '}' +
    '#wh-email-url-label {' +
    'font-size: 10px !important;' +
    '}' +
    '#wh-otp-container {' +
    'padding: 6px !important;' +
    '}' +
    '#wh-otp-label {' +
    'font-size: 12px !important;' +
    '}' +
    '.wh-message {' +
    'padding: 6px 8px;' +
    'font-size: 10px;' +
    '}' +
    '}' +
    '#wh-header {' +
    'display: flex;' +
    'justify-content: space-between;' +
    'align-items: center;' +
    'padding: 12px 15px;' +
    'background: rgba(0, 0, 0, 0.2);' +
    'color: white;' +
    'font-weight: bold;' +
    'font-size: 14px;' +
    'cursor: move;' +
    '}' +
    '#wh-toggle-btn {' +
    'background: rgba(255, 255, 255, 0.2);' +
    'border: none;' +
    'color: white;' +
    'width: 24px;' +
    'height: 24px;' +
    'border-radius: 50%;' +
    'cursor: pointer;' +
    'font-size: 16px;' +
    'line-height: 1;' +
    'transition: background 0.3s;' +
    '}' +
    '#wh-toggle-btn:hover {' +
    'background: rgba(255, 255, 255, 0.4);' +
    '}' +
    '#wh-content {' +
    'padding: 15px;' +
    'background: white;' +
    '}' +
    '#wh-content.collapsed {' +
    'display: none;' +
    '}' +
    '.wh-field {' +
    'margin-bottom: 15px;' +
    '}' +
    '.wh-field label {' +
    'display: block;' +
    'margin-bottom: 5px;' +
    'font-weight: 600;' +
    'color: #333;' +
    'font-size: 13px;' +
    '}' +
    '.wh-field input {' +
    'width: 100%;' +
    'padding: 10px 12px;' +
    'border: 2px solid #e0e0e0;' +
    'border-radius: 8px;' +
    'font-size: 14px;' +
    'transition: border-color 0.3s, box-shadow 0.3s;' +
    'box-sizing: border-box;' +
    '}' +
    '.wh-field input:focus {' +
    'outline: none;' +
    'border-color: #667eea;' +
    'box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);' +
    '}' +
    '.wh-buttons {' +
    'display: flex;' +
    'flex-direction: column;' +
    'gap: 10px;' +
    '}' +
    '.wh-btn {' +
    'padding: 10px 15px;' +
    'border: none;' +
    'border-radius: 8px;' +
    'font-size: 13px;' +
    'font-weight: 600;' +
    'cursor: pointer;' +
    'transition: transform 0.2s, box-shadow 0.2s;' +
    '}' +
    '.wh-btn:hover {' +
    'transform: translateY(-2px);' +
    'box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);' +
    '}' +
    '.wh-btn:active {' +
    'transform: translateY(0);' +
    '}' +
    '.wh-btn-primary {' +
    'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);' +
    'color: white;' +
    '}' +
    '.wh-btn-secondary {' +
    'background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);' +
    'color: white;' +
    '}' +
    '.wh-btn-success {' +
    'background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);' +
    'color: white;' +
    '}' +
    '.wh-message {' +
    'padding: 10px 12px;' +
    'border-radius: 6px;' +
    'margin-bottom: 10px;' +
    'font-size: 12px;' +
    'font-weight: 500;' +
    'display: flex;' +
    'align-items: center;' +
    'gap: 6px;' +
    '}' +
    '.wh-message.success {' +
    'background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);' +
    'color: #155724;' +
    'border: 1px solid #c3e6cb;' +
    '}' +
    '.wh-message.error {' +
    'background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);' +
    'color: #721c24;' +
    'border: 1px solid #f5c6cb;' +
    '}' +
    '.wh-message.warning {' +
    'background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);' +
    'color: #856404;' +
    'border: 1px solid #ffeeba;' +
    '}' +
    '.wh-message.info {' +
    'background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);' +
    'color: #0c5460;' +
    'border: 1px solid #bee5eb;' +
    '}' +
    '.wh-btn-info {' +
    'background: linear-gradient(135deg, #00c6fb 0%, #005bea 100%);' +
    'color: white;' +
    '}';

  // Th√™m v√†o DOM
  document.head.appendChild(styles);
  document.body.appendChild(formContainer);

  // Toggle form content
  var toggleBtn = document.getElementById('wh-toggle-btn');
  var content = document.getElementById('wh-content');
  var isCollapsed = false;

  toggleBtn.addEventListener('click', function () {
    isCollapsed = !isCollapsed;
    if (isCollapsed) {
      content.classList.add('collapsed');
      toggleBtn.textContent = '+';
    }
    else {
      content.classList.remove('collapsed');
      toggleBtn.textContent = '‚àí';
    }
  });

  // Fill Random Info
  document.getElementById('wh-fill-random').addEventListener('click', function () {
    var userEmail = document.getElementById('wh-email').value;

    if (!userEmail || userEmail.indexOf('@') === -1) {
      showMessage('‚ö†Ô∏è Vui l√≤ng nh·∫≠p email h·ª£p l·ªá tr∆∞·ªõc!', 'warning');
      document.getElementById('wh-email').focus();
      return;
    }

    var firstNameInput = document.getElementById('firstName');
    var lastNameInput = document.getElementById('lastName');
    var emailInput = document.getElementById('email');
    var termsCheckbox = document.getElementById('terms');

    if (!firstNameInput || !lastNameInput || !emailInput) {
      showMessage('‚ùå Kh√¥ng t√¨m th·∫•y c√°c input fields tr√™n trang!', 'error');
      return;
    }

    var randomFirstName = getRandomItem(firstNames);
    var randomLastName = getRandomItem(lastNames);

    setInputValue(firstNameInput, randomFirstName);
    setInputValue(lastNameInput, randomLastName);
    setInputValue(emailInput, userEmail);

    if (termsCheckbox) {
      setCheckbox(termsCheckbox, true);
    }

    clickContinueButton();
    console.log('‚úÖ ƒê√£ ƒëi·ªÅn: ' + randomFirstName + ' ' + randomLastName + ' - ' + userEmail);
  });

  // Fill Password
  document.getElementById('wh-fill-password').addEventListener('click', function () {
    var passwordInput = document.getElementById('password');
    var passwordConfirmInput = document.getElementById('passwordConfirmation');

    if (!passwordInput || !passwordConfirmInput) {
      showMessage('‚ùå Kh√¥ng t√¨m th·∫•y c√°c input password tr√™n trang!', 'error');
      return;
    }

    setInputValue(passwordInput, DEFAULT_PASSWORD);
    setInputValue(passwordConfirmInput, DEFAULT_PASSWORD);

    clickContinueButton();
    console.log('‚úÖ ƒê√£ ƒëi·ªÅn password th√†nh c√¥ng!');
  });

  // Generate Random Email
  document.getElementById('wh-generate-email').addEventListener('click', async function () {
    var generateBtn = this;
    var emailInput = document.getElementById('wh-email');
    var emailUrlContainer = document.getElementById('wh-email-url-container');
    var emailUrlLabel = document.getElementById('wh-email-url-label');

    // Disable button v√† hi·ªÉn th·ªã loading
    generateBtn.disabled = true;
    generateBtn.textContent = 'Generating...';

    try {
      // B∆∞·ªõc 1 & 2: L·∫•y domain h·ª£p l·ªá
      var domain = await getValidDomain();
      console.log('‚úÖ Domain ƒë∆∞·ª£c ch·ªçn:', domain);

      // B∆∞·ªõc 3: T·∫°o random username
      var username = generateRandomUsername();
      console.log('‚úÖ Username ƒë∆∞·ª£c t·∫°o:', username);

      // B∆∞·ªõc 4: T·∫°o email v√† fill v√†o input
      var fullEmail = username + '@' + domain;
      setInputValue(emailInput, fullEmail);
      console.log('‚úÖ Email ƒë√£ ƒë∆∞·ª£c t·∫°o:', fullEmail);

      // Hi·ªÉn th·ªã Email URL
      var emailUrl = 'tinyhost.shop/' + fullEmail;
      emailUrlLabel.textContent = 'Email URL: ' + emailUrl;
      emailUrlContainer.style.display = 'block';

      showMessage('‚úÖ ƒê√£ t·∫°o email: ' + fullEmail, 'success');
    } catch (error) {
      console.error('‚ùå L·ªói:', error);
      showMessage('‚ùå C√≥ l·ªói x·∫£y ra: ' + error.message, 'error', 5000);
    } finally {
      // Enable l·∫°i button
      generateBtn.disabled = false;
      generateBtn.textContent = 'Generate Random Email';
    }
  });

  // Copy Email
  document.getElementById('wh-copy-email').addEventListener('click', function () {
    var emailInput = document.getElementById('wh-email');
    var email = 'tinyhost.shop/' + emailInput.value;

    if (email) {
      copyToClipboard(email);
    } else {
      showMessage('‚ö†Ô∏è Ch∆∞a c√≥ email ƒë·ªÉ copy!', 'warning');
    }
  });

  // ·∫®n Email URL khi ng∆∞·ªùi d√πng t·ª± nh·∫≠p email
  document.getElementById('wh-email').addEventListener('input', function () {
    var emailUrlContainer = document.getElementById('wh-email-url-container');
    var otpContainer = document.getElementById('wh-otp-container');
    // Ch·ªâ ·∫©n n·∫øu kh√¥ng ph·∫£i t·ª´ script fill
    if (this.value && !this.value.match(/^[a-z]+[a-z]+\d{4}@/)) {
      emailUrlContainer.style.display = 'none';
      otpContainer.style.display = 'none';
    }
  });

  // H√†m g·ªçi API l·∫•y OTP t·ª´ email
  async function fetchOTPFromEmail(domain, username) {
    try {
      var response = await fetch('https://nguyenngocanhtu.com/api/email/' + domain + '/' + username + '/?page=1&limit=20');
      if (!response.ok) {
        throw new Error('API request failed');
      }
      var data = await response.json();
      return data.emails || [];
    } catch (error) {
      console.error('‚ùå L·ªói khi g·ªçi API email:', error);
      throw error;
    }
  }

  // H√†m extract OTP t·ª´ subject
  function extractOTPFromSubject(subject) {
    // Subject format: "016339 - Verify your Email with Windsurf"
    var match = subject.match(/^(\d{6})\s*-/);
    if (match) {
      return match[1];
    }
    return null;
  }

  // Fill OTP v√†o c√°c input v√† click Create account
  document.getElementById('wh-fill-otp').addEventListener('click', async function () {
    var fillOtpBtn = this;
    var emailInput = document.getElementById('wh-email');
    var otpContainer = document.getElementById('wh-otp-container');
    var email = emailInput.value;

    if (!email || email.indexOf('@') === -1) {
      showMessage('‚ö†Ô∏è Vui l√≤ng t·∫°o email tr∆∞·ªõc!', 'warning');
      return;
    }

    // Parse email ƒë·ªÉ l·∫•y username v√† domain
    var emailParts = email.split('@');
    var username = emailParts[0];
    var domain = emailParts[1];

    // Disable button v√† hi·ªÉn th·ªã loading
    fillOtpBtn.disabled = true;
    fillOtpBtn.textContent = 'Filling...';

    try {
      var emails = await fetchOTPFromEmail(domain, username);

      if (emails.length === 0) {
        showMessage('‚ö†Ô∏è Ch∆∞a c√≥ email n√†o trong h·ªôp th∆∞!', 'warning');
        return;
      }

      // T√¨m email c√≥ subject ch·ª©a "Verify your Email with Windsurf"
      var verifyEmail = null;
      for (var i = 0; i < emails.length; i++) {
        if (emails[i].subject && emails[i].subject.indexOf('Verify your Email with Windsurf') !== -1) {
          verifyEmail = emails[i];
          break;
        }
      }

      if (!verifyEmail) {
        showMessage('‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y email x√°c th·ª±c Windsurf!', 'warning');
        return;
      }

      // Extract OTP t·ª´ subject
      var otp = extractOTPFromSubject(verifyEmail.subject);

      if (!otp) {
        showMessage('‚ùå Kh√¥ng th·ªÉ l·∫•y m√£ OTP t·ª´ email!', 'error');
        return;
      }

      // Hi·ªÉn th·ªã OTP trong container
      var otpLabel = document.getElementById('wh-otp-label');
      otpLabel.textContent = 'OTP: ' + otp;
      otpContainer.style.display = 'block';
      otpContainer.setAttribute('data-otp', otp);

      // T√¨m c√°c input OTP tr√™n trang
      var otpInputs = document.querySelectorAll('div.flex.justify-between.gap-2 input[maxlength="1"]');

      if (otpInputs.length === 0) {
        showMessage('‚ùå Kh√¥ng t√¨m th·∫•y c√°c input OTP tr√™n trang!', 'error');
        return;
      }

      // Fill OTP v√†o t·ª´ng input
      for (var j = 0; j < otpInputs.length && j < otp.length; j++) {
        setInputValue(otpInputs[j], otp[j]);
      }

      console.log('‚úÖ ƒê√£ ƒëi·ªÅn OTP:', otp);

      // ƒê·ª£i m·ªôt ch√∫t r·ªìi click button Create account
      setTimeout(function () {
        var createAccountBtn = document.querySelector('button[type="submit"].bg-sk-aqua');

        if (createAccountBtn && !createAccountBtn.disabled) {
          createAccountBtn.click();
          console.log('‚úÖ ƒê√£ click button Create account');
          showMessage('‚úÖ ƒê√£ ƒëi·ªÅn OTP v√† click Create account!', 'success');
        } else {
          console.log('‚ö†Ô∏è Button Create account ƒëang disabled ho·∫∑c kh√¥ng t√¨m th·∫•y');
          showMessage('‚úÖ ƒê√£ ƒëi·ªÅn OTP! Button Create account ch∆∞a s·∫µn s√†ng.', 'warning');
        }
      }, 500);

    } catch (error) {
      console.error('‚ùå L·ªói:', error);
      showMessage('‚ùå C√≥ l·ªói x·∫£y ra: ' + error.message, 'error', 5000);
    } finally {
      // Enable l·∫°i button
      fillOtpBtn.disabled = false;
      fillOtpBtn.textContent = 'Fill OTP';
    }
  });

  // Copy OTP
  document.getElementById('wh-copy-otp').addEventListener('click', function () {
    var otpContainer = document.getElementById('wh-otp-container');
    var otp = otpContainer.getAttribute('data-otp');

    if (otp) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(otp).then(function () {
          showMessage('‚úÖ ƒê√£ copy OTP: ' + otp, 'success');
        }).catch(function (err) {
          showMessage('‚ùå L·ªói khi copy!', 'error');
        });
      } else {
        var textArea = document.createElement('textarea');
        textArea.value = otp;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showMessage('‚úÖ ƒê√£ copy OTP: ' + otp, 'success');
        } catch (err) {
          showMessage('‚ùå L·ªói khi copy!', 'error');
        }
        document.body.removeChild(textArea);
      }
    } else {
      showMessage('‚ö†Ô∏è Ch∆∞a c√≥ OTP ƒë·ªÉ copy!', 'warning');
    }
  });

  console.log('‚úÖ Windsurf Helper Form ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng!');
})();
